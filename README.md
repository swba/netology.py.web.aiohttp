# Домашнее задание к лекции «Aiohttp»

Данный проект представляет собой простой REST API
для сайта объявлений. Он основан на двух моделях
&mdash; пользователь (`User`) и объявление
(`Advertisement`). Для пользователей реализованы
методы регистрации (`/api/v1/register`) и входа
(`/api/v1/login`), для объявлений &mdash; 
создания (`/api/v1/advertisements`) и
получения/редактирования/удаления 
(`/api/v1/advertisements/{id}`).
Для создания, редактирования и удаления объявлений
требуется токен доступа (JWT), который возвращается
конечной точкой `/api/v1/login`. При этом 
редактировать и удалить объявление может только 
его автор.

## Структура проекта

- `config.py` &mdash; базовые константы, полученные
из переменных окружения.
- `models.py` &mdash; определения моделей.
- `db.py` &mdash; операции с базой данных.
- `crud.py` &mdash; универсальные CRUD-функции.
- `validation.py` &mdash; классы валидаторов 
pydantic и универсальная функция валидации данных.
- `errors.py` &mdash; класс HTTP-ошибок.
- `views.py` &mdash; функции представлений.
- `app.py` &mdash; приложение Aiohttp. 
- `client.py` &mdash; примеры запросов (не нужен, 
если запускать тесты).

## Конфигурация

Переменные окружения загружаются из `.env`-файла,
который исключён из git. Образец содержимого 
этого файла находится в файле `.env.example`. 

## Тестирование

Запустить тесты можно в Docker командой 
`docker compose up`. Чтобы всё заработало, 
переменные окружения `POSTGRES_HOST` и 
`APP_URL` должны соответствовать названиям
контейнеров, то есть иметь значения `db` и 
`http://app:8080` соответственно. Кроме того,
после запуска контейнеров можно осуществлять 
ручное локальное тестирование по адресу
http://127.0.0.1:8080, как в файле `client.py`.

## Примечания

- Для обработки ошибок, генерируемых приложением,
используется специальный класс `HttpError` вместо
встроенных исключений Aiohttp. Это сделано для 
того, чтобы валидаторы `pydantic` могли выбрасывать
исключения с сообщением об ошибке в виде словаря,
а не только обычного текста.